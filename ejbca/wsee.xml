<?xml version="1.0"?>
<project name="wsee" basedir=".">

	<!--  This file is included from build.xml and can not be run in itself -->

    <!-- =================================================================== -->
    <!-- Build ejbcaws part                                                                                                                             -->
    <!-- =================================================================== -->

    <taskdef name="java2wsdl" classname= "org.apache.axis.tools.ant.wsdl.Java2WsdlAntTask" classpathref="wsee.classpath"/>     
    <taskdef name="wsdl2java" classname="org.apache.axis.tools.ant.wsdl.Wsdl2javaAntTask" classpathref="wsee.classpath" />
    <target name="genejbcaws" depends="" description="Generates web service interface files">

    	<mkdir dir="tmp/wseesrc/wsdl"/>
    	<mkdir dir="tmp/wseesrc/java"/>
      <java2wsdl 
            classname="org.ejbca.core.protocol.ws.services.EjbcaRAWS"
            location="http://localhost:8080/ejbca/ejbcaws/services/EjbcaRAWS"
            namespace="http://ws.protocol.core.ejbca.org"
            output="tmp/wseesrc/wsdl/EjbcaRAWS.wsdl"
        	methods="test"
        	style="DOCUMENT"        	
            typemappingversion="1.1" 
        	useinheritedmethods="false" 
        	classpathref="compile.classpath">        	             
        </java2wsdl>
        <wsdl2java debug="false" 
        	helperGen="true" 

        	noimports="false"
            output="tmp/wseesrc/java"
            serverside="false" 
        	skeletonDeploy="false" 
        	testcase="true"
            typeMappingVersion="1.1"
            url="tmp/wseesrc/wsdl/EjbcaRAWS.wsdl" 
        	verbose="false"        	
        	>
        	  <mappingset>
        	  	 <mapping namespace="http://core.ejbca.org"
        	  	 	      package="org.ejbca.core.wsclient" />
       	  	     <mapping namespace="http://approval.model.core.ejbca.org"
       	  	 	          package="org.ejbca.core.model.approval.wsclient" /> 
      	  	     <mapping namespace="http://authorization.model.core.ejbca.org"
      	  	 	          package="org.ejbca.core.model.authorization.wsclient" /> 
      	  	     <mapping namespace="http://ra.model.core.ejbca.org"
      	  	 	          package="org.ejbca.core.model.ra.wsclient" /> 
     	  	     <mapping namespace="http://raadmin.ra.model.core.ejbca.org"
     	  	 	          package="org.ejbca.core.model.ra.raadmin.wsclient" /> 
    	  	     <mapping namespace="http://query.util.ejbca.org"
    	  	 	          package="org.ejbca.util.query.wsclient" /> 
   	  	         <mapping namespace="http://ws.protocol.core.ejbca.org"
   	  	 	              package="org.ejbca.core.protocol.ws.wsclient" /> 
  	  	         <mapping namespace="http://common.ws.protocol.core.ejbca.org"
  	  	 	              package="org.ejbca.core.protocol.ws.common.wsclient" /> 
              </mappingset>
        </wsdl2java> 
      </target>
	
	 <target name="ejbcaws.init">
        <available  file="tmp\wseesrc\wsdl\EjbcaRAWS.wsdl" property="ejbcaws.generated"></available> 
     </target>
	
      <target name="ejbcaws.war" depends="compile, ejbcaws.init" if="ejbcaws.generated">
      	    <replace file="${eardd.src}/META-INF/application.xml" token="!--@ejbcaws.war@-->" value="module>&lt;web>&lt;web-uri>ejbcaws.war&lt;/web-uri>&lt;context-root>/${app.name}/ejbcaws&lt;/context-root>&lt;/web>&lt;/module>"/>
       	    <mkdir dir="${ejbcaws.build}"/>
       	    <mkdir dir="${ejbcaws.build}/wsdl"/>
        	<mkdir dir="${ejbcaws.build}/WEB-INF/lib"/>
        	<mkdir dir="${ejbcaws.build}/WEB-INF/classes"/>
            <copy todir="${ejbcaws.build}">
                <fileset dir="${ejbcaws.src}" />
            </copy>
            <copy todir="${ejbcaws.build}/WEB-INF">
                <fileset dir="${ejbcaws.src}/WEB-INF" />
            </copy>
            <copy todir="${ejbcaws.build}/WEB-INF/lib">
                <fileset dir="dist" >
                	<include name="ejbca-ejb.jar"/>
                </fileset>
            	<fileset dir="${lib}/" >
                	<include name="log4j-1.2.7.jar"/>
                </fileset>
            	<!--       <fileset dir="${lib}/ext/" >
                	<include name="servlet-2.3.jar"/>
                </fileset>
              <fileset dir="${jboss.home}/client">
                    <include name="jbossall-client.jar" />
                    <include name="jboss-j2ee.jar" />
                </fileset> -->
                <fileset dir="${lib}/wsee" >
                	<include name="*.jar"/>
                	<include name="*.properties"/>
                </fileset>
            </copy> 
           <javac srcdir="${tmp}/wseesrc/java" destdir="${ejbcaws.build}/WEB-INF/classes" debug="on" includeantruntime="no" encoding="iso8859-1">
            <classpath refid="wsee.classpath" />
            <include name="**/*.java" />
           </javac>
            <copy todir="${ejbcaws.build}/WEB-INF/classes">
                <fileset dir="${build}" >
                	<include name="org/ejbca/core/protocol/ws/*"/>
                	<include name="org/ejbca/core/protocol/ws/common/*"/>
                 	<include name="org/ejbca/core/protocol/ws/services/*"/> 
                </fileset>
            </copy>
            <copy todir="${ejbcaws.build}/wsdl">
              <fileset dir="${tmp}/wseesrc/wsdl" >
            	<include name="*.wsdl"/>
              </fileset>
            </copy>
        	<!-- <copy tofile="${ejbcaws.build}/WEB-INF/server-config.wsdd" file="${tmp}/wseesrc/java/org/ejbca/core/protocol/ws/wsclient/deploy.wsdd"/>     -->
            <war  destfile="${ejbcawswar}" webxml="${ejbcaws.src}/WEB-INF/web.xml">
                <fileset dir="${ejbcaws.build}" excludes="WEB-INF/web.xml" />
            </war>  
    	    	    	
    </target>
    <!-- =================================================================== -->
    <!-- Build ejbcaws part                                                  -->
    <!-- =================================================================== -->	
    <target name="ejbcaws.cli" depends="ejbcaws.war" description="Builds EJBCA webservice part">
    	<mkdir dir="tmp/ejbcawscli.jar"/>
    	<mkdir dir="tmp/ejbcawscli.jar/META-INF"/>
    	<mkdir dir="tmp/ejbcawscli.jar/META-INF/wsdl"/>
    	<mkdir dir="dist/ejbcaws/cli"/>
 
            <javac destdir="${build}" debug="on" includeantruntime="no" encoding="iso8859-1">
                <classpath refid="wsee.classpath" />
            	<include name="org/ejbca/core/protocol/ws/client/*.java" />
                <src path="${src.java}" />
                <src path="${src.gen}" />
            	<src path="${tmp}/wseesrc/java" />
            </javac>
    	
        <copy todir="tmp/ejbcawscli.jar">
            <fileset dir="${build}">
              <include name="org/ejbca/core/protocol/ws/client/*.class"/>
              <include name="org/ejbca/core/protocol/ws/common/*.class"/>
            </fileset>	
	    </copy>  
        <copy todir="tmp/ejbcawscli.jar">
            <fileset dir="${ejbcaws.build}/WEB-INF/classes">
              <include name="**/wsclient/*.class"/>
            </fileset>	
	    </copy>  
	    <copy todir="tmp/ejbcawscli.jar/META-INF/wsdl">
	       <fileset dir="${tmp}/wseesrc/wsdl">
             <include name="*.wsdl"/> 
           </fileset>
        </copy> 
        <copy todir="dist/ejbcaws//cli">
            <fileset dir="${ejbca.home}/lib">        
              <include name="bcprov-jdk15.jar"/>  
            </fileset>	
            <fileset dir="${ejbca.home}/dist">
              <include name="ejbca-util.jar"/>         
            </fileset>	    
	        <fileset dir="${lib}/wsee">
				<include name="axis.jar" />
				<include name="commons-discovery-0.2.jar" />
				<include name="commons-logging-1.0.4.jar" />
				<include name="jaxrpc.jar" />
			    <include name="saaj.jar" />	
			    <include name="wsdl4j-1.5.1.jar" />	 
			</fileset>
	        <fileset dir="${lib}">
				<include name="log4j-1.2.7.jar" />
			</fileset>
	    </copy> 
	    <copy todir="tmp/ejbcawscli.jar">
            <fileset dir="src">
                <include name="log4j.properties" />
            </fileset>
        </copy>
    	
	    <copy todir="dist/ejbcaws/cli/">
            <fileset dir="${src}/wsee/cli">
                <include name="*.*" />
            </fileset>
        </copy>
	    
        <jar destfile="dist/ejbcaws/cli/ejbcawscli.jar" basedir="tmp/ejbcawscli.jar">
          <manifest>
          	<attribute name="Class-Path" value="wsdl4j-1.5.1.jar saaj.jar jaxrpc.jar commons-discovery-0.2.jar commons-logging-1.0.4.jar axis.jar bcprov-jdk15.jar ejbca-util.jar log4j-1.2.7.jar "/>
            <attribute name="Main-Class" value="org.ejbca.core.protocol.ws.client.ejbcawsracli"/>
          </manifest>
        </jar>
 
    	    	    	
    </target>

</project>
