<?xml version="1.0" encoding="UTF-8"?>
<project name="build-properties">
    <description>
            This file load property files and keeps track of different paths. It should not be run directly. 
    </description>

	<!-- Get the correct relative path when this file is imported. -->
	<dirname property="build-properties.basedir" file="${ant.file.build-properties}"/>
    <property file="${build-properties.basedir}/../src/internal.properties" />
    <property name="ejbca.home" location="${build-properties.basedir}/.." />
    <property environment="env" />
	<!--
		Merge custom modifications from customejbca.home to
		ejbca.home before reading the other configuration files.
	-->
    <property file="${ejbca.home}/conf/custom.properties" />
    <property name="customejbca.home" location="${ejbca.home}/../ejbca-custom" />
    <available file="${customejbca.home}" type="dir" property="customejbca.present" />
    <condition property="customejbca.message" else="No custom changes to merge."
    	value="Merging available external modifications from ${customejbca.home}.">
    	<isset property="customejbca.present" />
    </condition>
	<echo message="${customejbca.message}" />
    <condition property="customejbca.extensions" value="*" else="none-at-all">
    	<isset property="customejbca.present" />
    </condition>
    <condition property="customejbca.dir" value="${customejbca.home}" else="${ejbca.home}/conf">	<!-- This is just any dir that we know exists to avoid error messages.. -->
    	<isset property="customejbca.present" />
    </condition>
	<copy todir="${ejbca.home}" overwrite="true" failonerror="false">
		<fileset dir="${customejbca.dir}" >
			<include name="**/*.${customejbca.extensions}"/>
   		</fileset>
	</copy>
	<!-- Load property files -->
    <property file="${ejbca.home}/conf/${app.name}.properties" />
    <property file="${ejbca.home}/conf/protection.properties" />
    <property file="${ejbca.home}/conf/database.properties" />
    <property file="${ejbca.home}/conf/mail.properties" />
    <property file="${ejbca.home}/conf/ocsp.properties" />
    <property file="${ejbca.home}/conf/web.properties" />
    <property file="${ejbca.home}/conf/cmp.properties" />
    <property file="${ejbca.home}/conf/jaxws.properties" />
    <property file="${ejbca.home}/conf/xkms.properties" />
    <property file="${ejbca.home}/conf/externalra.properties" />

    <!-- A little special something to handle backward compatibility with 
         people using JBOSS_HOME. They can switch to APPSRV_HOME now, and both will work. 
    -->        
    <condition property="jboss.home" value="${env.JBOSS_HOME}" >
        <equals arg1="${appserver.home}" arg2="${appserver.home}"/>
    </condition>
    <condition property="appserver.home" value="${env.APPSRV_HOME}" else="${jboss.home}">
        <contains string="${jboss.home}" substring="JBOSS_HOME"/>
    </condition>
	
    <property name="ejbca.dist.path" location="${ejbca.home}/dist" />
    <!-- Define the different modules -->
    <property name="mod.path" location="${ejbca.home}/modules" />
    <property name="mod.systemtests.path" location="${mod.path}/systemtests" />
    <property name="mod.dist.path" location="${mod.path}/dist" />
    <property name="mod.ejbca-entity.path" location="${mod.path}/ejbca-entity" />
    <property name="mod.ejbca-entity.lib" location="${mod.dist.path}/ejbca-entity.jar" />
    <property name="mod.ejbca-ejb.lib" location="${ejbca.dist.path}/ejbca-ejb.jar" />
    <property name="mod.ejbca-ejb.path" location="${mod.path}/ejbca-ejb" />
    <property name="mod.ejbca-ejb-cli.dist" location="${ejbca.dist.path}/ejbca-ejb-cli" />
    <property name="mod.ejbca-ejb-cli.lib" location="${mod.ejbca-ejb-cli.dist}/ejbca-ejb-cli.jar" />
    <property name="mod.ejbca-ejb-cli.path" location="${mod.path}/ejbca-ejb-cli" />
    <property name="mod.ejbca-ejb-interface.path" location="${mod.path}/ejbca-ejb-interface" />
    <property name="mod.ejbca-ejb-interface.lib" location="${mod.dist.path}/ejbca-ejb-interface.jar" />
    <property name="mod.ejbca-util.path" location="${mod.path}/ejbca-util" />
    <property name="mod.ejbca-util.lib" location="${ejbca.dist.path}/ejbca-util.jar" />
    <property name="mod.ejbca-ws-cli.lib" location="${ejbca.dist.path}/ejbcawscli/ejbcawscli.jar" />
    <property name="mod.ejbca-xkms-cli.lib" location="${ejbca.dist.path}/xkmscli/xkmscli.jar" />
    <property name="mod.clientToolBox.dist" location="${ejbca.dist.path}/clientToolBox" />
    <property name="mod.clientToolBox.lib" location="${mod.clientToolBox.dist}/clientToolBox.jar" />
    <property name="mod.clientToolBox.path" location="${mod.path}/clientToolBox" />
	
	<!-- Files of global interest -->
    <property name="jndi.properties.file" location="${ejbca.home}/src/java/jndi.properties" />
    
    <!-- Variables of global interest -->
    <property name="java.target.version" value="1.5"/>	<!-- This should probably be defined in internal.properties -->

	<!-- Define class-paths of global interest -->
	<path id="lib.cert-cvc.classpath"><fileset dir="${ejbca.home}/lib" includes="cert-cvc.jar"/></path>

	<path id="lib.junit.classpath">
		<fileset dir="${ejbca.home}/lib/ext">
			<include name="junit-*.jar"/>
			<include name="commons-httpclient-*.jar"/>	<!-- ProtocolScepHttpTest -->
			<include name="htmlunit-*.jar"/>	<!-- ProtocolScepHttpTest -->
			<include name="commons-io-*.jar"/>	<!-- ProtocolScepHttpTest -->
		</fileset>
	</path>

	<path id="lib.log4j.classpath"><fileset dir="${ejbca.home}/lib" includes="log4j*.jar"/></path>
	<path id="lib.commons-lang.classpath"><fileset dir="${ejbca.home}/lib" includes="commons-lang-*.jar"/></path>
	<path id="lib.commons-config.classpath"><fileset dir="${ejbca.home}/lib" includes="commons-configuration-*.jar"/></path>
	<path id="lib.commons-collections.classpath"><fileset dir="${ejbca.home}/lib" includes="commons-collections-*.jar"/></path>
	<path id="lib.commons-logging.classpath"><fileset dir="${ejbca.home}/lib" includes="commons-logging*.jar"/></path>
	<path id="lib.jline.classpath"><fileset dir="${ejbca.home}/lib" includes="jline-*.jar"/></path>
	<path id="lib.batik.classpath"><fileset dir="${ejbca.home}/lib/batik" includes="*.jar"/></path>
	<path id="lib.mail.classpath"><fileset dir="${ejbca.home}/lib/ext" includes="mail.jar"/></path>
	<path id="lib.servlet.classpath"><fileset dir="${ejbca.home}/lib/ext" includes="servlet-*.jar"/></path>
	<path id="lib.jline.classpath"><fileset dir="${ejbca.home}/lib" includes="jline-*.jar"/></path>
	<path id="lib.ldap.classpath"><fileset dir="${ejbca.home}/lib" includes="ldap.jar"/></path>
	<path id="lib.xmlsec.classpath"><fileset dir="${ejbca.home}/lib/xmlsign/" includes="xmlsec-*.jar"/></path>
	<path id="lib.clover.classpath"><pathelement location="/home/hudson/clover/clover-ant-2.5.0/lib/clover.jar"/></path>
	

	<path id="lib.utils.classpath">
		<fileset dir="${ejbca.home}/lib">
			<include name="commons-*.jar"/>
			<include name="log4j*.jar"/>
		</fileset>
	</path>

	<property name="lib.jaxws.dir" location="${ejbca.home}/lib/jaxws"/>
	<path id="lib.jaxws-client.classpath">
        <fileset dir="${ejbca.home}/lib/jaxws">
            <include name="jaxb*.jar"/>
            <include name="saaj-*.jar"/>
            <include name="jaxws-api.jar"/>
            <include name="jaxws-rt.jar"/>
            <include name="sjsxp.jar"/>
            <include name="jsr181-api.jar"/>
            <include name="jsr173_api.jar"/>
            <include name="activation.jar"/>
        </fileset>
	</path>

	<path id="lib.jee.classpath">
		<fileset dir="${appserver.home}">
			<!-- jboss -->
			<include name="client/jbossall-client.jar" />
			<include name="client/jboss-j2ee.jar" />
			<!-- glassfish -->
			<include name="lib/javaee.jar"/>
			<include name="lib/appserv-rt.jar"/>
			<!-- weblogic -->
			<include name="server/lib/weblogic.jar"/>	<!-- For 9.2 -->
			<include name="server/lib/wlclient.jar"/>	<!-- For 10.3 -->
			<!-- oracle -->
			<include name="j2ee/home/oc4jclient.jar"/>
			<!-- websphere -->
			<include name="runtimes/com.ibm.*.jar"/>
		</fileset>
	</path>
	
	<path id="lib.ejbca-util.classpath">
    	<pathelement location="${ejbca.home}/lib/cert-cvc.jar"/>
    	<pathelement location="${mod.ejbca-util.lib}"/>
	</path>

	<path id="lib.bouncycastle.classpath">
		<fileset dir="${ejbca.home}/lib">
			<include name="bcmail-jdk15.jar"/>
			<include name="bcprov-jdk15.jar"/>
			<include name="bctsp-jdk15.jar"/>
		</fileset>
	</path>

	<path id="lib.jpa.classpath">
        <fileset dir="${ejbca.home}/lib/xdoclet/lib" includes="dom4j-1.6.1.jar.jar"/>
        <fileset dir="${ejbca.home}/lib/hibernate">
            <include name="antlr-2.7.6.jar"/>
            <include name="hibernate3.jar"/>
            <include name="hibernate-core.jar"/>
            <include name="hibernate-annotations.jar"/>
            <include name="hibernate-commons-annotations.jar"/>
            <include name="hibernate-entitymanager.jar"/>
            <include name="hibernate-validator.jar"/>
            <include name="javassist-3.4.GA.jar"/>
            <include name="ejb3-persistence.jar"/>
            <include name="slf4j-api-1.5.2.jar"/>
            <include name="slf4j-log4j12.jar"/>
            <include name="jta-1.1.jar"/>
        </fileset>
	</path>

	<path id="lib.clientToolBox.classpath">
        <path location="${mod.clientToolBox.dist}/properties" />
        <path location="${mod.clientToolBox.lib}" />
        <path>
			<fileset dir="${mod.clientToolBox.dist}/lib" includes="*.jar" />
		</path>
	</path>

    <!-- Now when everything is set up, we can load the old property defaults -->
	<import file="${build-properties.basedir}/../propertyDefaults.xml"/>


</project>
