Set up PostgresSQL as database for EJBCA in JBoss
=================================================

NOTE: This document is work in progress. So far it only describes how to set
up PostgreSQL as the DefaultDS, which is what have to be done to use it in EJBCA. 

The default database HypersoniqDB should also be removed completely. 
The section "JBossCX setup" must be edited for this.

Also support for transactions in PostgreSQL should be described.

NOW ON TO THE HOWTO!

Configuring EJBCA
-----------------

No configuration has to be done in EJBCA, PostgreSQL works with default values.

Build with 'ant' and deploy with 'deploy.sh/cmd'.

Configuring JBoss
-----------------

1. Download and install PostgreSQL (http://www.postgresql.org).

2. Create a new database for ejbca, ex. ejbca.

2. Make sure the JDBC-jar is included, otherwise download it from http://jdbc.postgresql.org/.

4. Put the JDBC jar (postgresql.jar or whatever it's called) in jboss/lib/ext.

THE DESCRIPTION BELOW IS FOR JBOSS 2.4.x, FOR JBOSS 3.x PLEASE SEE OFFICIAL DOCS.

5. Edit jboss.jcml. org.postgresql.Driver must be inluded as driver and
PostgreSQL set up as DefaultDS.

The JDBC section should look something like:

     <!-- =================================================================-->
     <!-- JDBC-->
     <!-- =================================================================-->

     <mbean code="org.jboss.jdbc.JdbcProvider" name="DefaultDomain:service=JdbcProvider">
          <attribute name="Drivers">org.postgresql.Driver</attribute>
     </mbean>

     <mbean code="org.jboss.jdbc.XADataSourceLoader" name="DefaultDomain:service=XADataSource,name=DefaultDS">
       <attribute name="PoolName">DefaultDS</attribute>
       <attribute name="DataSourceClass">org.jboss.pool.jdbc.xa.wrapper.XADataSourceImpl</attribute>
       <attribute name="Properties"></attribute>
       <attribute name="URL">jdbc:postgresql://localhost/ejbca</attribute>
       <attribute name="JDBCUser">postgres</attribute>
       <attribute name="Password">yourpassword</attribute>
       <attribute name="MaxSize">10</attribute>
       <attribute name="MinSize">0</attribute>
       <attribute name="IdleTimeout">1800000</attribute>
       <attribute name="MaxIdleTimeoutPercent">1.0</attribute>
     </mbean>

6. Edit standardjaws.xml. Change the default type-mapping to PostgreSQL.

     <type-mapping>PostgreSQL</type-mapping>

7. DONE! Start JBoss. Run all tests with 'runtest.sh/cmd'.
   Use your favorite PostgreSQL SQL editor to look at the beautiful tables.

Configuring PostgreSQL
----------------------

- Database permissions can be a bit tricky with PostgreSQL. Make sure the user defined in 'JDBCUser' above
have permissons to access the database, otherwise a 'NullpointerException' will be thrown during startup of 
JBoss.


