Set up a database for EJBCA in JBoss
====================================

The following databases have been tested with EJBCA:

* PostegreSQL (http://www.postgresql.org/)
* MySQL (http://www.mysql.com/)
* Oracle 8i (http://www.oracle.com/)
* HypersoniqDB (default in JBoss)

NOTE:

To use the default database, HypersonicDB, nothing should be done, just install
JBoss and run. Read this HOWTO if you want to replace the default database with
another.

When using another database the default database, HypersoniqDB, should be
removed
completely. The file server/defualt/deploy/hsqldb-service.xml should be removed.

NOW ON TO THE HOWTO!

Configuring EJBCA
-----------------

1. Rename src/ca/META-INF/jaws-<database>.xml to jaws.xml. If no specific
jaws-<database>.xml file is supplied the default jaws.xml is used. Make sure
src/ca/META-INF/jaws.xml contains entries to set the correct type-mappings for
'base64cert' and 'base64crl' for the database used.

2. Build EJBCA with 'ant' and deploy with 'deploy.sh/cmd'.

Configuring JBoss
-----------------

The description given here is for JBoss 3.x. Consider consulting the
official JBoss documentation.

First comes the general description and in the end database specific
configurations
are given in sections for the specific databases.

Database configuration files in JBoss (with Tomcat or Jetty) is located in the
<jboss-home>/server/default/deploy.

1. Install and setup the database.

2. Create a database for EJBCA, for example 'ejbca'.

2. Put the JDBC driver for the database in <jboss-home>/server/default/lib/.

4. Copy the proper <database>-service.xml file to <jboss-home>
/server/default/deploy. The JDBC-driver must be inluded and the database set up
as DefaultDS. Current <database>-service.xml files can be obtained from
jboss.org, provided here are snapshots that work for me.

6. Edit standardjaws.xml. Change the default type-mapping to match the chosen
database (see below).

7. DONE! Start JBoss. Run all tests with 'runtest.sh/cmd'.
   Use your favorite database graphic editor to look at the beautiful tables.

MySQL specifics
---------------
Jaws configuration file: jaws-mysql.xml

JDBC driver: mm.mysql-<version>-bin.jar.

Download JDBC driver for mySQL from http://mmmysql.sourceforge.net/

Copy mysql-service.xml to server/default/deploy
In mysql-service.xml is defined the databas instance (EJBCA) and the database
username (EJBCA) and password (EJBCA).These must be changed to your values.
The item 'ConnectionURL' must be edited to match your database.

Type mapping:

     <datasource>java:/DefaultDS</datasource>
     <type-mapping>mySQL</type-mapping>

PostgreSQL specifics
--------------------
Jaws configuration file: PostgreSQL works woth standard jaws.xml.

JDBC driver: postgresql.jar (or whatever it's called).

If the JDBC-jar is not included, download it from http://jdbc.postgresql.org/.

Copy postgres-service.xml to server/default/deploy
In postgres-service.xml is defined the databas instance (EJBCA) and the database
username (EJBCA) and password (EJBCA).These must be changed to your values.
The item 'ConnectionURL' must be edited to match your database.

Type mapping:

     <datasource>java:/DefaultDS</datasource>
     <type-mapping>PostgreSQL</type-mapping>

Oracle specifics
----------------
Jaws configuration file: jaws-oracle.xml
JBoss configuration file: oracle-service.xml

JDBC driver: classes12.zip (can be downloaded from http://www.oracle.com/).

Create tables manually in the database according to database-tables.sql.

Copy oracle-service.xml to server/default/deploy
In oracle-service.xml is defined the databas instance (EJBCA) and the database
username (EJBCA) and password (EJBCA).These must be changed to your values.
The item 'ConnectionURL' must be edited to match your database.

Type mapping:

     <datasource>java:/DefaultDS</datasource>
     <type-mapping>Oracle8</type-mapping>

