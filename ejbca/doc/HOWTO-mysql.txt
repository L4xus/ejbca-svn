Set up mySQL as database for EJBCA in JBoss
===========================================

NOTE: This document is work in progress. So far it only describes how to set
up mySQL as the DefaultDS, which is what have to be done to use mySQL in EJBCA. 

The default database HypersoniqDB should be removed completely. 
The section "JBossCX setup" must be edited for this.

Also support for transactions in mySQL should be described.

NOW ON TO THE HOWTO!

Configuring EJBCA
-----------------

1. Rename src/ca/META-INF/jaws-mysql.xml to jaws.xml.
   Make sure src/ca/META-INF/jaws.xml contains entries to set the correct type-mappings 
   for 'b64cert' and 'b64crl' for mySQL.

2. Build with 'ant' and deploy with 'deploy.sh/cmd'.

Configuring JBoss
-----------------

Configuration files in JBoss is located in the jboss/conf/Tomcat or Jetty directory.

1. Download and install mySQL (http://www.mysql.com).

2. Create a new database for ejbca, ex. ejbca.

3. Download JDBC driver for mySQL from http://mmmysql.sourceforge.net/

4. Put mm.mysql-<version>-bin.jar in jboss/lib/ext.

THE DESCRIPTION BELOW IS FOR JBOSS 2.4.x, FOR JBOSS 3.x PLEASE SEE OFFICIAL DOCS.

5. Edit jboss.jcml. org.gjt.mm.mysql.Driver must be inluded as driver and
mySQL set up as DefaultDS.

The JDBC section should look something like:

     <!-- =================================================================-->
     <!-- JDBC-->
     <!-- =================================================================-->

     <mbean code="org.jboss.jdbc.JdbcProvider" name="DefaultDomain:service=JdbcProvider">
          <attribute name="Drivers">org.gjt.mm.mysql.Driver,org.hsqldb.jdbcDriver</attribute>
     </mbean>

     <mbean code="org.jboss.jdbc.XADataSourceLoader" name="DefaultDomain:service=XADataSource,name=DefaultDS">
       <attribute name="PoolName">DefaultDS</attribute>
       <attribute name="DataSourceClass">org.jboss.pool.jdbc.xa.wrapper.XADataSourceImpl</attribute>
       <attribute name="Properties"></attribute>
       <attribute name="URL">jdbc:mysql://localhost/ejbca</attribute>
       <attribute name="JDBCUser">root</attribute>
       <attribute name="Password">yourpassword</attribute>
       <attribute name="MaxSize">10</attribute>
       <attribute name="MinSize">0</attribute>
       <attribute name="IdleTimeout">1800000</attribute>
       <attribute name="MaxIdleTimeoutPercent">1.0</attribute>
     </mbean>

6. Edit standardjaws.xml. Change the default type-mapping to mySQL.

     <type-mapping>mySQL</type-mapping>     

7. DONE! Start JBoss. Run all tests with 'runtest.sh/cmd'.
   Use your favorite mySQL graphic editor to look at the beautiful tables.
