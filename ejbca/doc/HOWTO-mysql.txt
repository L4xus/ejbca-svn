HOWTO set up mySQL as database for EJBCA in JBoss
-------------------------------------------------

NOTE: This document is work in progress. So far it only describes how to set
up mySQL as the DefaultDS, which is what have to be done to use mySQL in EJBCA. 

The default database HypersoniqDB should also be removed completely. 
The section "JBossCX setup" must probably be edited for this.

Also support for transactions in mySQL should be described.

Now on to the howto:

Configuring EJBCA:
------------------

1. Make sure src/ca/META-INF/jaws.xml contains extries to set the correct type-mappings 
   for 'b64cert' and 'b64crl' for mySQL.

2. 'ant' and deploy.

Configuring JBoss:
------------------

1. Download and install mySQL (www.mysql.com).

2. Create a new database for ejbca, ex. ejbca.

3. Download JDBC driver for mySQL from http://mmmysql.sourceforge.net/

4. Put mm.mysql-<version>-bin.jar in jboss/lib/ext.

THE DESCRIPTION BELOW IS FOR JBOSS 2.4.x, FOR JBOSS 3.x PLEASE SEE OFFICIAL DOCS.

5. Edit jboss.jcml. org.gjt.mm.mysql.Driver must be inluded as driver and
mySQL set up as DefaultDS.

The JDBC section should look something like:

<!-- =================================================================-->
<!-- JDBC-->
<!-- =================================================================-->

<mbean code="org.jboss.jdbc.JdbcProvider" name="DefaultDomain:service=JdbcProvider">
     <attribute name="Drivers">org.gjt.mm.mysql.Driver,org.hsqldb.jdbcDriver</attribute>
</mbean>

<mbean code="org.jboss.jdbc.XADataSourceLoader" name="DefaultDomain:service=XADataSource,name=DefaultDS">
  <attribute name="PoolName">DefaultDS</attribute>
  <attribute name="DataSourceClass">org.jboss.pool.jdbc.xa.wrapper.XADataSourceImpl</attribute>
  <attribute name="Properties"></attribute>
  <attribute name="URL">jdbc:mysql://localhost/ejbca</attribute>
  <attribute name="JDBCUser">root</attribute>
  <attribute name="Password">yourpassword</attribute>
</mbean>

6. Edit standardjaws.xml. Change the default type-mapping to mySQL.

<type-mapping>mySQL</type-mapping>

7. DONE! Start JBoss. Run all tests with 'runtest.sh/cmd'.
   Use your favorite mySQL graphic editor to look at the beautiful tables.
