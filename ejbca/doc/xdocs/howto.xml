<?xml version="1.0"?>
<document>

  <properties>
    <title>Howto</title>
  </properties>

<body>
  <section name="Howto documents">
    <p>
    A number of HOWTO documents are available in the <strong>doc/howto</strong> directory in the source distribution.
    </p>
    </section>
    
  <section name="SensorNet PKI">
    <p>
    This excellent HOWTO on PKI in general, LDAP, email and server setup has been kindly contributed by SensorNet. Please read this notice!
    </p>
    <note>
These pages were created by the SensorNet Project at Oak Ridge National
Laboratory (ORNL), Oak Ridge, Tennessee, USA to provide help for their
instance of EJBCA. You are welcome to modify these pages for your own
use, but please remove any links to the SensorNetCA web pages so that we
do not get excess traffic. Please tell your users not to use the URLs in
the screen shots, and please credit Oak Ridge National Laboratory. ORNL
is operated by UT-Battelle for the U.S. Department Of Energy.
    </note>
    <p>
    <ul>
    <li><a href="sensornet/infrastructure.html">SensorNet certificate infrastructure </a></li>
    <li><a href="sensornet/short-course.html">A short course on certificates</a></li>
    <li><a href="sensornet/ca-enrollment.html">Certificate Authority Enrollment</a></li>
    <li><a href="sensornet/CertificateInfrastructure.html">SensorNet certificate infrastructure basics and enrollment</a></li>
	</ul>
	</p>
	
	<subsection name="Managing certificates">
	<p>
	<ul>
    <li><a href="sensornet/MozillaHowTo/MozillaCertificateManagement.html">Using Mozilla</a></li>
    <li><a href="sensornet/IEHowTo/ManagingCertificateIE.html">Using Microsoft Internet Explorer</a></li>
    </ul>
    </p>
	</subsection>

	<subsection name="Configuring email client and LDAP">
	<p>
	<ul>
    <li><a href="sensornet/LDAPHowTo/SecureEmailNS-Moz/LDAPandMail.html">Using Mozilla</a></li>
    <li><a href="sensornet/LDAPHowTo/SecureEmailO/SecureEmailUsingOutlook.html">Using Microsoft Outlook</a></li>
    <li><a href="sensornet/LDAPHowTo/SecureEmailOE/Securee-mail%20OutlookExpress.html">Using Microsoft Outlook Express</a></li>
    </ul>
    </p>
	</subsection>

	<subsection name="Server certificates">
	<p>
	<ul>
    <li><a href="sensornet/IISHowTo/ServerCert.html">Microsoft IIS</a></li>
    <li><a href="sensornet/howto-server.html">Apache HTTPd and Unix servers</a></li>
    <li><a href="sensornet/howto-tomcat.html">Apache Tomcat</a></li>
    </ul>
    </p>
    </subsection>
    
  </section>
  
  <section name="Migrating an OpenSSL based CA">
  <p>
  Read the <a href="http://www.csita.unige.it/software/free/ejbca/">howto</a> at Csita.
  </p>
  </section>
  
  <section name="EJBCA and Cisco IOS">
  <p>This howto is contributed by Bruno Bonfils.</p>
  <p>
  There is a <a href="http://www.ipflow.utc.fr/index.php/Cisco_7200_Simulator">Cisco 7200 emulator</a> available.
  </p>
  <p>Here is the IOS config related to the CA:
  </p>
  <source>
!
crypto ca trustpoint FMSCA
enrollment url http://your.ca.host.name:8080/ejbca/publicweb/apply/scep
serial-number
source interface Ethernet0
auto-enroll regenerate
!
  </source>
  <p>
  <ul>
    <li>The enrollment line tell how (the method, here an http url) to contact the PKI software. Note: you must omit the pkiclient.exe filename at the end which is automagically add by IOS.</li>
    <li>The serial-number tells IOS to include the serial number in the request.</li>
    <li>The name of the trustpoint you use MUST MATCH exactly the shortname of your CA in EJBCA (here FMSCA).</li>
  </ul>
  Once you have that, use the command:
  </p>
  <source>
# crypto ca authenticate FMSCA  
  </source>
  <p>
  to fetch the CA certificate.
  </p>
  <p>
  Then, login to EJBCA, and create a new entity profile that looks like:
  </p>
  <p>
  <img alt="End Entity profile for IOS" src="images/ios-profile.jpg"/>
  </p>
  <p>
  Then, do the password enrollment with the command:  
  </p>
  <source>
# crypto ca enroll FMSCA
  </source>
  <p>
  Check your ejbca logs, you shoud see something like:
  </p>
  <source>
ERROR [PKCS10RequestMessage] No CN in DN: SN=12013150+unstructuredName=your.ciscobox.hosts.name
ERROR [Log4jLogDevice] October 19, 2005 9:48:33 AM CEST, CAId : 0, CA, EVENT_ERROR_USERAUTHENTICATION, Administrator : PUBLICWEBUSER, IP Address : 192.168.134.1, User : 12013150, Certificate : No Certificate Involved, Comment : Got request for nonexisting user: 12013150
  </source>
  <p>
  So, you know you must add an entity using the serial number as username, the password you define in IOS, and serialNumber/unstructuredNamed as subject DN fields.
  </p>
  <p>
  After adding the end entity, do the password enrollment again. If you see this you have enrolled succesfully:
  </p>
  <source>
saroumane#sh crypto ca cert
Certificate
  Status: Available
  Certificate Serial Number: 426FA96340F5D2CA
  Certificate Usage: General Purpose
  Issuer:
    c=FR
    o=Fimasys
    cn=Fimasys Security CA
  Subject:
    Name: your.ciscobox.hosts.name
    Serial Number: 12013150
    serialNumber=12013150
    hostname=your.ciscobox.hosts.name
  Validity Date:
    start date: 08:58:28 CET Oct 19 2005
    end   date: 09:08:28 CET Oct 19 2007
  Associated Trustpoints: FMSCA

CA Certificate
  Status: Available
  Certificate Serial Number: 7AA2B9942CD0D362
  Certificate Usage: Signature
  Issuer:
    c=FR
    o=Fimasys
    cn=Fimasys Security CA
  Subject:
    c=FR
    o=Fimasys
    cn=Fimasys Security CA
  Validity Date:
    start date: 07:29:35 CET Oct 17 2005
    end   date: 07:39:35 CET Oct 15 2015
  Associated Trustpoints: FMSCA  
  </source>

  </section>

  <section name="OpenSSH and X509 authentication">
  <p>Bruno Bonfils has written this excellent howto on using SSH with certificates from EJBCA:</p>
  <p>
  <a href="http://asyd.net/home/geeklog/2006/08/24/openssh_x509">OpenSSH and X509 authentication</a>.
  </p>
  <p>
  Another interesting link is this one:
  <br/>
  <a href="http://alon.barlev.googlepages.com/openssh-pkcs11">PKCS#11 support in OpenSSH</a>.
  </p>
  </section>
  
</body>
</document>

