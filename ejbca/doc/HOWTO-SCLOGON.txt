This what should be done in order to get card that could be used for smartcard logon.

Please note that [x] refers to one of the references listed in the end of the file.

1. install PrimeCA and PrimeCard according to READMEs.
   choose to generate a first token.
   copy PrimeCard files to jboss after PrimeCA installation but before restart of jboss.

2. generate the LDAPS p12
Use "Add End Entity" with the following settings:
    Profile. EMPTY
    CN. the name of the domain controller. ex maud.int.primekey.se
    Token. P12

3. Do the following on the domain controller:
   1. use mmc and add the snap-in "Certificates (Local Computer)"
   2. import the key and certificate in the p12 file to the Personal store.
   3. do step 1 and 2 of the configuration instructions described in [1].
   4. execute gpupdate /force

4. define a publisher in "Edit Publishers"
   The following fields must be modified. Do not touch any other field:
    * Type. use AD
    * Hostname
    * Base DN. if the name of domain is int.primekey.se then set Base DN to CN=Users,DC=int,DC=primekey,DC=se
    * Login DN. set CN to the name of a user with privilege to publish users to AD. ex CN=Lars Silvén,CN=Users,DC=int,DC=primekey,DC=se
    * Login Password. the password of the user above.
    * Use Fields in DN. Choose only CN

5. Try "Save and test connection" in "Edit Publisher". If it is not working read the document [2]
   and figure out what the problem is.

6. Use "Add/remove win components" to install a "Enterprise root CA" on the domain controller.
   Right click on the Personal folder in the snap-in of the local computer in msc and request a domain controller certificate.

7. Import the CA certificate to "Enterprise NTAuth store" according to [3].

8. Define a certificate profile that fulfils the requirements of step 5 of [1].
   The profile should also use the previous defined publisher. Use HARDTOKEN_AUTHENC as template.

9. Edit the hard token profile so it uses the newly created certificate profile.

10. Edit the end-entity profile for the Administration token so that it contains all fields needed according to step 5 of [1].

11. Add a user with the administrator token end entity profile.



References
[1] http://support.microsoft.com/default.aspx?scid=kb;en-us;281245
[2] http://support.microsoft.com/default.aspx?scid=kb;en-us;321051
[3] http://support.microsoft.com/default.aspx?scid=kb;en-us;295663