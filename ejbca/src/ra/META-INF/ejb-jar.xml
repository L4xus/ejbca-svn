<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE ejb-jar PUBLIC
	"-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 2.0//EN"
	"http://java.sun.com/dtd/ejb-jar_2_0.dtd">
<ejb-jar>

 <description></description>
 <display-name>RA component</display-name>

 <enterprise-beans>

   <session>
     <description>
         Session bean handling user administration, uses UserData entity bean
     </description>
     <ejb-name>UserAdminSession</ejb-name>
     <home>se.anatom.ejbca.ra.IUserAdminSessionHome</home>
     <remote>se.anatom.ejbca.ra.IUserAdminSessionRemote</remote>
     <ejb-class>se.anatom.ejbca.ra.LocalUserAdminSessionBean</ejb-class>
     <session-type>Stateless</session-type>
     <transaction-type>Container</transaction-type>

     <env-entry>
        <description>JDBC datasource to be used</description>
        <env-entry-name>DataSource</env-entry-name>
        <env-entry-type>java.lang.String</env-entry-type>
        <env-entry-value>java:/DefaultDS</env-entry-value>
     </env-entry>

     <!-- Env-entries for starting an external RMI service using SSL -->
     <env-entry>
        <description>Factory class can dynamically link to external implementation class.</description>
        <env-entry-name>RMIFactory</env-entry-name>
        <env-entry-type>java.lang.String</env-entry-type>
        <env-entry-value>se.walter.cardPersonalization.ra.ejbca.RMIFactoryImpl</env-entry-value>
     </env-entry>
     <!-- END Env-entries for starting an external RMI service using SSL -->
     <!-- Env-entries used for notification configuration -->
     <env-entry>
        <description>Defines de sender of the notification message</description>
        <env-entry-name>sender</env-entry-name>
        <env-entry-type>java.lang.String</env-entry-type>
        <env-entry-value>philip@primekey.se</env-entry-value>
     </env-entry>
     <env-entry>
        <description>Defines the subject used in the notification message</description>
        <env-entry-name>subject</env-entry-name>
        <env-entry-type>java.lang.String</env-entry-type>
        <env-entry-value>Hämta ditt certifikat</env-entry-value>
     </env-entry>
     <env-entry>
        <description>Defines the actual message of the notification. Use the values $Username, $Password, $CN, $O, $OU, $C, $DATE to indicate which texts that should be replaced (Case insensitive), $NL stands for newline.</description>
        <env-entry-name>message</env-entry-name>
        <env-entry-type>java.lang.String</env-entry-type>
        <env-entry-value>Hej $CN$NL$NL Detta är en test på en notification. $NL$NL Du har användarnamn: $Username$NL lösenord: $Password$NL$NL Du skall nu INTE gå ngnstans och hämta ditt certifikat för detta Är bara på skoj och för att bevisa för er att det fungerar nu.</env-entry-value>
     </env-entry>          
     <!-- END Env-entries used for notification configuration -->     
     <ejb-ref>
        <description>The Certificate Store session bean</description>
        <ejb-ref-name>ejb/CertificateStoreSession</ejb-ref-name>
        <ejb-ref-type>Session</ejb-ref-type>
        <home>se.anatom.ejbca.ca.store.ICertificateStoreSessionHome</home>
        <remote>se.anatom.ejbca.ca.store.ICertificateStoreSessionRemote</remote>
        <ejb-link>CertificateStoreSession</ejb-link>
     </ejb-ref>
     <ejb-ref>
        <description>The Log session bean</description>
        <ejb-ref-name>ejb/LogSession</ejb-ref-name>
        <ejb-ref-type>Session</ejb-ref-type>
        <home>se.anatom.ejbca.log.ILogSessionHome</home>
        <remote>se.anatom.ejbca.log.ILogSessionRemote</remote>
        <ejb-link>LogSession</ejb-link>
     </ejb-ref>
     <ejb-local-ref>
        <description>The Authorization session bean</description>
        <ejb-ref-name>ejb/AuthorizationSessionLocal</ejb-ref-name>
        <ejb-ref-type>Session</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.authorization.IAuthorizationSessionLocalHome</local-home>
        <local>se.anatom.ejbca.ra.authorization.IAuthorizationSessionLocal</local>
        <ejb-link>AuthorizationSession</ejb-link>
     </ejb-local-ref>
     <ejb-local-ref>
        <description>The Ra Admin session bean</description>
        <ejb-ref-name>ejb/RaAdminSessionLocal</ejb-ref-name>
        <ejb-ref-type>Session</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.raadmin.IRaAdminSessionLocalHome</local-home>
        <local>se.anatom.ejbca.ra.raadmin.IRaAdminSessionLocal</local>
        <ejb-link>RaAdminSession</ejb-link>
     </ejb-local-ref>
     <ejb-local-ref>
        <description>The User entity bean</description>
        <ejb-ref-name>ejb/UserDataLocal</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.UserDataLocalHome</local-home>
        <local>se.anatom.ejbca.ra.UserDataLocal</local>
        <ejb-link>UserData</ejb-link>
     </ejb-local-ref>
     <ejb-local-ref>
        <description>
          The GlobalConfigurationData Entity bean
        </description>
        <ejb-ref-name>ejb/GlobalConfigurationDataLocal</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.GlobalConfigurationDataLocalHome</local-home>
        <local>se.anatom.ejbca.ra.GlobalConfigurationDataLocal</local>
        <ejb-link>GlobalConfigurationData</ejb-link>
     </ejb-local-ref>
     <resource-ref>
       <res-ref-name>mail/DefaultMail</res-ref-name>
       <res-type>javax.mail.Session</res-type>
       <res-auth>Container</res-auth>
    </resource-ref>
   </session>

   <session>
     <description>
         Session bean handling interface with ra administration web services, uses entity beans
         EndEntityProfileData and AdminPreferencesData
     </description>
     <ejb-name>RaAdminSession</ejb-name>
     <home>se.anatom.ejbca.ra.raadmin.IRaAdminSessionHome</home>
     <remote>se.anatom.ejbca.ra.raadmin.IRaAdminSessionRemote</remote>
     <local-home>se.anatom.ejbca.ra.raadmin.IRaAdminSessionLocalHome</local-home>
     <local>se.anatom.ejbca.ra.raadmin.IRaAdminSessionLocal</local>
     <ejb-class>se.anatom.ejbca.ra.raadmin.LocalRaAdminSessionBean</ejb-class>
     <session-type>Stateless</session-type>
     <transaction-type>Container</transaction-type>
     <env-entry>
        <description>JDBC datasource to be used</description>
        <env-entry-name>DataSource</env-entry-name>
        <env-entry-type>java.lang.String</env-entry-type>
        <env-entry-value>java:/DefaultDS</env-entry-value>
     </env-entry>
     <ejb-ref>
        <description>The Log session bean</description>
        <ejb-ref-name>ejb/LogSession</ejb-ref-name>
        <ejb-ref-type>Session</ejb-ref-type>
        <home>se.anatom.ejbca.log.ILogSessionHome</home>
        <remote>se.anatom.ejbca.log.ILogSessionRemote</remote>
        <ejb-link>LogSession</ejb-link>
     </ejb-ref>
     <ejb-local-ref>
        <description>
          The AdminPreferencesData Entity bean
        </description>
        <ejb-ref-name>ejb/AdminPreferencesDataLocal</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.raadmin.AdminPreferencesDataLocalHome</local-home>
        <local>se.anatom.ejbca.ra.raadmin.AdminPreferencesDataLocal</local>
        <ejb-link>AdminPreferencesData</ejb-link>
     </ejb-local-ref>
     <ejb-local-ref>
        <description>
          The EndEntityProfileData Entity bean
        </description>
        <ejb-ref-name>ejb/EndEntityProfileDataLocal</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.raadmin.EndEntityProfileDataLocalHome</local-home>
        <local>se.anatom.ejbca.ra.raadmin.EndEntityProfileDataLocal</local>
        <ejb-link>EndEntityProfileData</ejb-link>
     </ejb-local-ref>

     <security-identity>
        <description></description>
        <run-as>
            <description></description>
            <role-name>InternalUser</role-name>
        </run-as>
      </security-identity>
   </session>

   <session>
     <description>
         Session bean handling interface with ra authorization, uses entity beans AvailableAccessRules,
         AdminGroupData
     </description>
     <ejb-name>AuthorizationSession</ejb-name>
     <home>se.anatom.ejbca.ra.authorization.IAuthorizationSessionHome</home>
     <remote>se.anatom.ejbca.ra.authorization.IAuthorizationSessionRemote</remote>
     <local-home>se.anatom.ejbca.ra.authorization.IAuthorizationSessionLocalHome</local-home>
     <local>se.anatom.ejbca.ra.authorization.IAuthorizationSessionLocal</local>
     <ejb-class>se.anatom.ejbca.ra.authorization.LocalAuthorizationSessionBean</ejb-class>
     <session-type>Stateless</session-type>
     <transaction-type>Container</transaction-type>
     <env-entry>
        <description>JDBC datasource to be used</description>
        <env-entry-name>DataSource</env-entry-name>
        <env-entry-type>java.lang.String</env-entry-type>
        <env-entry-value>java:/DefaultDS</env-entry-value>
     </env-entry>
     <ejb-ref>
        <description>The Log session bean</description>
        <ejb-ref-name>ejb/LogSession</ejb-ref-name>
        <ejb-ref-type>Session</ejb-ref-type>
        <home>se.anatom.ejbca.log.ILogSessionHome</home>
        <remote>se.anatom.ejbca.log.ILogSessionRemote</remote>
        <ejb-link>LogSession</ejb-link>
     </ejb-ref>
     <ejb-local-ref>
        <description>
          Available Access Rules
        </description>
        <ejb-ref-name>ejb/AvailableAccessRulesDataLocal</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.authorization.AvailableAccessRulesDataLocalHome</local-home>
        <local>se.anatom.ejbca.ra.authorization.AvailableAccessRulesDataLocal</local>
        <ejb-link>AvailableAccessRulesData</ejb-link>
     </ejb-local-ref>
     <ejb-local-ref>
        <description>
          Admin Groups
        </description>
        <ejb-ref-name>ejb/AdminGroupDataLocal</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.authorization.AdminGroupDataLocalHome</local-home>
        <local>se.anatom.ejbca.ra.authorization.AdminGroupDataLocal</local>
        <ejb-link>AdminGroupData</ejb-link>
     </ejb-local-ref>
     <ejb-local-ref>
        <description>
          Access Rules
        </description>
        <ejb-ref-name>ejb/AccessRulesDataLocal</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.authorization.AccessRulesDataLocalHome</local-home>
        <local>se.anatom.ejbca.ra.authorization.AccessRulesDataLocal</local>
        <ejb-link>AccessRulesData</ejb-link>
     </ejb-local-ref>
     <ejb-local-ref>
        <description>
          Admin Entities
        </description>
        <ejb-ref-name>ejb/AdminEntityDataLocal</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.authorization.AdminEntityDataLocalHome</local-home>
        <local>se.anatom.ejbca.ra.authorization.AdminEntityDataLocal</local>
        <ejb-link>AdminEntityData</ejb-link>
     </ejb-local-ref>
     <security-identity>
        <description></description>
        <run-as>
        <description></description>
            <role-name>InternalUser</role-name>
        </run-as>
      </security-identity>
   </session>

   <entity>
      <description>
            This enterprise bean entity represents a User with accompanying data.
      </description>
      <ejb-name>UserData</ejb-name>
      <home>se.anatom.ejbca.ra.UserDataHome</home>
      <remote>se.anatom.ejbca.ra.UserDataRemote</remote>
      <local-home>se.anatom.ejbca.ra.UserDataLocalHome</local-home>
      <local>se.anatom.ejbca.ra.UserDataLocal</local>
      <ejb-class>se.anatom.ejbca.ra.UserDataBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>se.anatom.ejbca.ra.UserDataPK</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>UserDataBean</abstract-schema-name>

      <cmp-field><field-name>username</field-name></cmp-field>
      <cmp-field><field-name>subjectDN</field-name></cmp-field>
      <cmp-field><field-name>subjectAltName</field-name></cmp-field>
      <cmp-field><field-name>subjectEmail</field-name></cmp-field>
      <cmp-field><field-name>status</field-name></cmp-field>
      <cmp-field><field-name>type</field-name></cmp-field>
      <cmp-field><field-name>clearPassword</field-name></cmp-field>
      <cmp-field><field-name>passwordHash</field-name></cmp-field>
      <cmp-field><field-name>timeCreated</field-name></cmp-field>
      <cmp-field><field-name>timeModified</field-name></cmp-field>
      <cmp-field><field-name>endEntityProfileId</field-name></cmp-field>
      <cmp-field><field-name>certificateProfileId</field-name></cmp-field>
      <cmp-field><field-name>tokenType</field-name></cmp-field>
      <cmp-field><field-name>hardTokenIssuerId</field-name></cmp-field>
      <cmp-field><field-name>keyStorePassword</field-name></cmp-field>

      <query>
      	<query-method>
      	  <method-name>findBySubjectDN</method-name>
      	  <method-params>
      	    <method-param>java.lang.String</method-param>
      	  </method-params>
      	</query-method>
	<ejb-ql>
	  <![CDATA[SELECT DISTINCT OBJECT(a) from UserDataBean a WHERE a.subjectDN=?1]]>
	</ejb-ql>
      </query>
      <query>
      	<query-method>
      	  <method-name>findBySubjectEmail</method-name>
      	  <method-params>
      	    <method-param>java.lang.String</method-param>
      	  </method-params>
      	</query-method>
	<ejb-ql>
	  <![CDATA[SELECT DISTINCT OBJECT(a) from UserDataBean a WHERE a.subjectEmail=?1]]>
	</ejb-ql>
      </query>
      <query>
      	<query-method>
      	  <method-name>findByStatus</method-name>
      	  <method-params>
      	    <method-param>int</method-param>
      	  </method-params>
      	</query-method>
	<ejb-ql>
	  <![CDATA[SELECT DISTINCT OBJECT(a) from UserDataBean a WHERE a.status=?1]]>
	</ejb-ql>
      </query>
      <query>
        <query-method>
         <method-name>findAll</method-name>
         <method-params></method-params>
        </query-method>
        <ejb-ql>
          <![CDATA[SELECT DISTINCT OBJECT(a) from UserDataBean a]]>
        </ejb-ql>
      </query>

   </entity>

   <entity>
      <description>
            This enterprise bean entity represents global configuration of ra administration.
      </description>
      <ejb-name>GlobalConfigurationData</ejb-name>
      <local-home>se.anatom.ejbca.ra.GlobalConfigurationDataLocalHome</local-home>
      <local>se.anatom.ejbca.ra.GlobalConfigurationDataLocal</local>
      <ejb-class>se.anatom.ejbca.ra.GlobalConfigurationDataBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>java.lang.String</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>GlobalConfigurationDataBean</abstract-schema-name>
      <cmp-field><field-name>configurationId</field-name></cmp-field>
      <cmp-field><field-name>data</field-name></cmp-field>
      <primkey-field>configurationId</primkey-field>

      <query>
      	<query-method>
      	  <method-name>findByConfigurationId</method-name>
      	  <method-params>
      	    <method-param>java.lang.String</method-param>
      	  </method-params>
      	</query-method>
	<ejb-ql>
	  <![CDATA[SELECT DISTINCT OBJECT(a) from GlobalConfigurationDataBean a WHERE a.configurationId=?1]]>
	</ejb-ql>
      </query>
   </entity>

   <entity>
      <description>
            This enterprise bean entity represents a ra admins user preference.
      </description>
      <ejb-name>AdminPreferencesData</ejb-name>
      <local-home>se.anatom.ejbca.ra.raadmin.AdminPreferencesDataLocalHome</local-home>
      <local>se.anatom.ejbca.ra.raadmin.AdminPreferencesDataLocal</local>
      <ejb-class>se.anatom.ejbca.ra.raadmin.AdminPreferencesDataBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>java.lang.String</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>AdminPreferencesDataBean</abstract-schema-name>
      <cmp-field><field-name>id</field-name></cmp-field>
      <cmp-field><field-name>data</field-name></cmp-field>
       <primkey-field>id</primkey-field>
   </entity>

   <entity>
      <description>
            This enterprise bean entity represents a profile.
      </description>
      <ejb-name>EndEntityProfileData</ejb-name>
      <local-home>se.anatom.ejbca.ra.raadmin.EndEntityProfileDataLocalHome</local-home>
      <local>se.anatom.ejbca.ra.raadmin.EndEntityProfileDataLocal</local>
      <ejb-class>se.anatom.ejbca.ra.raadmin.EndEntityProfileDataBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>java.lang.Integer</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>EndEntityProfileDataBean</abstract-schema-name>
      <cmp-field><field-name>id</field-name></cmp-field>
      <cmp-field><field-name>profileName</field-name></cmp-field>
      <cmp-field><field-name>data</field-name></cmp-field>
      <primkey-field>id</primkey-field>

      <query>
      	<query-method>
      	  <method-name>findByProfileName</method-name>
      	  <method-params>
      	    <method-param>java.lang.String</method-param>
      	  </method-params>
      	</query-method>
	<ejb-ql>
	  <![CDATA[SELECT DISTINCT OBJECT(a) from EndEntityProfileDataBean a WHERE a.profileName=?1]]>
	</ejb-ql>
      </query>
       <query>
           <query-method>
             <method-name>findAll</method-name>
             <method-params>
             </method-params>
           </query-method>
         <ejb-ql>
           <![CDATA[SELECT DISTINCT OBJECT(a) from EndEntityProfileDataBean a]]>
         </ejb-ql>
       </query>
       
   </entity>

   <entity>
      <description>
            This enterprise bean entity represents an authorization usergroup.
      </description>
      <ejb-name>AdminGroupData</ejb-name>
      <local-home>se.anatom.ejbca.ra.authorization.AdminGroupDataLocalHome</local-home>
      <local>se.anatom.ejbca.ra.authorization.AdminGroupDataLocal</local>
      <ejb-class>se.anatom.ejbca.ra.authorization.AdminGroupDataBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>java.lang.String</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>AdminGroupDataBean</abstract-schema-name>
      <cmp-field><field-name>adminGroupName</field-name></cmp-field>
      <primkey-field>adminGroupName</primkey-field>
      <ejb-local-ref>
        <ejb-ref-name>ejb/AdminEntityDataLocal</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.authorization.AdminEntityDataLocalHome</local-home>
        <local>se.anatom.ejbca.ra.authorization.AdminEntityDataLocal</local>
        <ejb-link>AdminEntityData</ejb-link>
      </ejb-local-ref>
      <ejb-local-ref>
        <ejb-ref-name>ejb/AccessRulesDataLocal</ejb-ref-name>
        <ejb-ref-type>Entity</ejb-ref-type>
        <local-home>se.anatom.ejbca.ra.authorization.AccessRulesDataLocalHome</local-home>
        <local>se.anatom.ejbca.ra.authorization.AccessRulesDataLocal</local>
        <ejb-link>AccessRulesData</ejb-link>
      </ejb-local-ref>
      <query>
        <query-method>
          <method-name>findAll</method-name>
            <method-params></method-params>
        </query-method>
        <ejb-ql>
          <![CDATA[SELECT DISTINCT OBJECT(a) from AdminGroupDataBean a]]>
        </ejb-ql>
      </query>
   </entity>

   <entity>
      <description>
            This enterprise bean entity represents a user entity.
      </description>
      <ejb-name>AdminEntityData</ejb-name>
      <local-home>se.anatom.ejbca.ra.authorization.AdminEntityDataLocalHome</local-home>
      <local>se.anatom.ejbca.ra.authorization.AdminEntityDataLocal</local>
      <ejb-class>se.anatom.ejbca.ra.authorization.AdminEntityDataBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>se.anatom.ejbca.ra.authorization.AdminEntityPK</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>AdminEntityDataBean</abstract-schema-name>
      <cmp-field><field-name>pK</field-name></cmp-field>
      <cmp-field><field-name>matchWith</field-name></cmp-field>
      <cmp-field><field-name>matchType</field-name></cmp-field>
      <cmp-field><field-name>matchValue</field-name></cmp-field>
   </entity>
   <entity>
      <description>
            This enterprise bean entity represents an access rule.
      </description>
      <ejb-name>AccessRulesData</ejb-name>
      <local-home>se.anatom.ejbca.ra.authorization.AccessRulesDataLocalHome</local-home>
      <local>se.anatom.ejbca.ra.authorization.AccessRulesDataLocal</local>
      <ejb-class>se.anatom.ejbca.ra.authorization.AccessRulesDataBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>se.anatom.ejbca.ra.authorization.AccessRulesPK</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>AccessRulesDataBean</abstract-schema-name>
      <cmp-field><field-name>pK</field-name></cmp-field>
      <cmp-field><field-name>resource</field-name></cmp-field>
      <cmp-field><field-name>accessRule</field-name></cmp-field>
   </entity>

   <entity>
      <description>
            This enterprise bean entity represents available access rules in ra authorization.
      </description>
      <ejb-name>AvailableAccessRulesData</ejb-name>
      <local-home>se.anatom.ejbca.ra.authorization.AvailableAccessRulesDataLocalHome</local-home>
      <local>se.anatom.ejbca.ra.authorization.AvailableAccessRulesDataLocal</local>
      <ejb-class>se.anatom.ejbca.ra.authorization.AvailableAccessRulesDataBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>java.lang.String</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>AvailableAccessRulesDataBean</abstract-schema-name>
      <cmp-field><field-name>name</field-name></cmp-field>
      <primkey-field>name</primkey-field>
      <query>
        <query-method>
          <method-name>findAll</method-name>
          <method-params></method-params>
        </query-method>
        <ejb-ql>
          <![CDATA[SELECT DISTINCT OBJECT(a) from AvailableAccessRulesDataBean a]]>
        </ejb-ql>
      </query>
   </entity>
   
  </enterprise-beans>

  <relationships>
     <ejb-relation>
       <ejb-relation-name>AdminGroupDataToAdminEntities</ejb-relation-name>
       <ejb-relationship-role>
         <ejb-relationship-role-name>AdminGroupData</ejb-relationship-role-name>
         <multiplicity>One</multiplicity>
         <relationship-role-source>
           <ejb-name>AdminGroupData</ejb-name>
         </relationship-role-source>
         <cmr-field>
           <cmr-field-name>adminEntities</cmr-field-name>
           <cmr-field-type>java.util.Collection</cmr-field-type>
         </cmr-field>
       </ejb-relationship-role>
       <ejb-relationship-role>
         <ejb-relationship-role-name>AdminEntityData</ejb-relationship-role-name>
         <multiplicity>Many</multiplicity>
         <relationship-role-source>
           <ejb-name>AdminEntityData</ejb-name>
         </relationship-role-source>
       </ejb-relationship-role>
     </ejb-relation>

     <ejb-relation>
       <ejb-relation-name>AdminGroupDataToAccessRules</ejb-relation-name>
       <ejb-relationship-role>
         <ejb-relationship-role-name>AdminGroupData</ejb-relationship-role-name>
         <multiplicity>One</multiplicity>
         <relationship-role-source>
           <ejb-name>AdminGroupData</ejb-name>
         </relationship-role-source>
         <cmr-field>
           <cmr-field-name>accessRules</cmr-field-name>
           <cmr-field-type>java.util.Collection</cmr-field-type>
         </cmr-field>
       </ejb-relationship-role>
       <ejb-relationship-role>
         <ejb-relationship-role-name>AccessRulesData</ejb-relationship-role-name>
         <multiplicity>Many</multiplicity>
         <relationship-role-source>
           <ejb-name>AccessRulesData</ejb-name>
         </relationship-role-source>
       </ejb-relationship-role>
     </ejb-relation>
  </relationships>

  <assembly-descriptor>
   <security-role>
      <description>
         This role represents everyone
      </description>
     <role-name>everyone</role-name>
   </security-role>
   <security-role>
      <description>
         This role represents an internal process
      </description>
      <role-name>InternalUser</role-name>
    </security-role>

   <!--
       Method permissions define who can access a given method on a bean.
       Role name internalUser means that the bean methods should NOT be
       accessible from the outside.
       Role name everyone means that the bean methods can be accessible from
       the outside.
       NOTE! Security must be enabled in the container for these settings
       to have any real meaning.
   -->
   <method-permission>
     <role-name>InternalUser</role-name>
     <method>
         <ejb-name>UserData</ejb-name>
         <method-name>*</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>*</method-name>
     </method>
   </method-permission>

   <!--
       Transaction settings. Default setting i for *, which is overridden
       for methods with special transactional needs.
       Required is used for mission critical methods, which cannot collide.
       Supports is used for methods which only read data.
   -->
    <container-transaction>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>findUser</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>findUserBySubjectDN</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>findUserByEmail</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>checkIfCertificateBelongToAdmin</method-name>
     </method>
    <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>findAllUsersByStatus</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>findAllUsersWithLimit</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>checkForEndEntityProfileId</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>checkForCertificateProfileId</method-name>
     </method>
    <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>loadGlobalConfiguration</method-name>
     </method>
    <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>query</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>getAdminPreference</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>existsAdminPreference</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>getDefaultAdminPreference</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>getEndEntityProfileNames</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>getEndEntityProfiles</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>getEndEntityProfile</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>getNumberOfEndEntityProfiles</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>getEndEntityProfileId</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>getEndEntityProfileName</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>existsCertificateProfileInEndEntityProfiles</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>isAuthorized</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>isAuthorizedNoLog</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>authenticate</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>getAdminGroup</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>getNumberOfAdminGroups</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>getAdminGroupnames</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>getAdminGroups</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>getNumberOfAccessRules</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>getAccessRules</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>getNumberOfAdminEntities</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>getAdminEntities</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>getAvailableAccessRules</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>existsAvailableAccessRule</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>existsEndEntityProfileInRules</method-name>
     </method>
     <trans-attribute>Supports</trans-attribute>
   </container-transaction>

   <container-transaction>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>addUser</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>changeUser</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>deleteUser</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>setUserStatus</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>setPassword</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>setClearTextPassword</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>revokeUser</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>revokeCert</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>startExternalService</method-name>
     </method>
     <method>
         <ejb-name>UserAdminSession</ejb-name>
         <method-name>saveGlobalConfiguration</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>addAdminPreference</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>changeAdminPreference</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>changeAdminPreferenceNoLog</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>saveDefaultAdminPreference</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>addEndEntityProfile</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>cloneEndEntityProfile</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>removeEndEntityProfile</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>renameEndEntityProfile</method-name>
     </method>
     <method>
         <ejb-name>RaAdminSession</ejb-name>
         <method-name>changeEndEntityProfile</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>init</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>addAdminGroup</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>removeAdminGroup</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>renameAdminGroup</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>addAccessRule</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>removeAccessRule</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>addAdminEntity</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>removeAdminEntity</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>addAvailableAccessRule</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>addAvailableAccessRules</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>removeAvailableAccessRule</method-name>
     </method>
     <method>
         <ejb-name>AuthorizationSession</ejb-name>
         <method-name>removeAvailableAccessRules</method-name>
     </method>

     <trans-attribute>Required</trans-attribute>
   </container-transaction>


 </assembly-descriptor>
</ejb-jar>
