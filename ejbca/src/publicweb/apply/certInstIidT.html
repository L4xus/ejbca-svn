<HTML>
<HEAD>
  <META NAME="EJBCA" CONTENT="EJBCA">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <TITLE>IID Certificate enrollment.</TITLE>
	<script type="text/javascript">
	<!--
		function showLocalCSPActiveX() {
			sClassid = '$CLASSID';
			if ( navigator.appName.indexOf("Explorer") != -1 ) {
				document.writeln("<object classid=\""+sClassid+"\" id=\"g_objClassFactory\"></object>");
			}
		}
		showLocalCSPActiveX()
	-->
	</script>
	<!--<object classid="$CLASSID" id="keystore"></object>-->
</HEAD>
<BODY bgcolor="#ffffff" link="black" vlink="black" alink="black" onload="downloadCert()">

	<SCRIPT language=VBScript>
		Function ControlExists(objectID)
			on error resume next
			ControlExists = IsObject(CreateObject(objectID))
		End Function

		Function IsCSPInstalled(sCSPName)
			On Error Resume Next
			Dim objCSPInformations
			Set objCSPInformations	= g_objClassFactory.CreateObject("X509Enrollment.CCspInformations")                 
			If Err.Number=0 Then
				objCSPInformations.AddAvailableCsps  
			End If
			IsCSPInstalled = IsObject(objCSPInformations.ItemByName(sCSPName))
		End Function	'IsCSPInstalled
	</SCRIPT>

	<SCRIPT LANGUAGE="JavaScript">
	    var plugin;
		function myDeclare() {
			if (navigator.appName.indexOf("Explorer") == -1) {
				explorer = false;
				plugin = navigator.mimeTypes["application/x-iid"];
			} else {
				explorer = true;
				if ( navigator.userAgent.indexOf("Windows NT 6") == -1 ) {
					plugin = ControlExists("IID.iIDCtl");
				} else {
					plugin = IsCSPInstalled("Net iD - CSP");
				}
			}
			if (plugin) {
				if (explorer) {
					document.writeln("<object name=\"iID\" classid=\"CLSID:5BF56AD2-E297-416E-BC49-00B327C4426E\" width=\"0\" height=\"0\"></object>");
				} else {
					document.writeln("<object name=\"iID\" type=\"application/x-iid\" width=\"0\" height=\"0\"></object>");
				}
			} else {
				document.writeln("The CryptoAPI component is not installed.");
			}
		} // myDeclare

		function downloadCert()
		{
			if (plugin) {
				document.iID.SetProperty('Certificate', 'TAG_cert');
				rv = document.iID.Invoke('WriteCertificate');
				if (rv != 0) {
					alert("Error when writing certificate to card: "+rv);
				}
			}
		} // downloadCert

		myDeclare();

</SCRIPT>

<table align="center" cellspacing="4" cellpadding="4" border="0" width="60%"><tr>
  <td valign="top"><font size="3" face="Arial"><strong>A new certificate has been installed on your card.</strong></font></td>
</tr></table>
<p><a href="javascript:history.back()">Go back</a></p>
</BODY>
</HTML>
