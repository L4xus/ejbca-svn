<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE>Kort Certifikatbeg&auml;ran</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 2.0  (Linux)">
	<META NAME="CREATED" CONTENT="20060812;7291400">
	<META NAME="CHANGED" CONTENT="20060812;11052100">
	<script type="text/javascript">
	<!--
		function showCSPActiveX() {
			if (navigator.appName.indexOf("Explorer") != -1) {
			    if ( navigator.userAgent.indexOf("Windows NT 6") != -1 ) {
					document.writeln("<object classid=\"clsid:884e2049-217d-11da-b2a4-000e7bbb2b09\" id=\"g_objClassFactory\" height=\"0\" width=\"0\" ></object>");
				} else {
					document.writeln("<object classid=\"clsid:127698e4-e730-4e5c-a2b1-21490a70c8a1\" id=\"newencoder\" codebase=\"/CertControl/xenroll.cab#Version=5,131,3659,0\" height=\"0\" width=\"0\" ></object>");
					document.writeln("<object classid=\"clsid:43F8F289-7A20-11D0-8F06-00C04FC295E1\" id=\"oldencoder\" height=\"0\" width=\"0\" ></object>");
				}
			}
		}
		showCSPActiveX();
	-->
	</script>
	<SCRIPT LANGUAGE="VBScript">
		Function ControlExists(objectID)
			On Error Resume Next
			ControlExists = IsObject(CreateObject(objectID))
		End Function

		Function IsCSPInstalled(sCSPName)
			On Error Resume Next
			Dim objCSPInformations
			Set objCSPInformations	= g_objClassFactory.CreateObject("X509Enrollment.CCspInformations")                 
			If Err.Number=0 Then
				objCSPInformations.AddAvailableCsps  
			End If
			IsCSPInstalled = IsObject(objCSPInformations.ItemByName(sCSPName))
		End Function	'IsCSPInstalled
	</SCRIPT>
	<SCRIPT LANGUAGE="JavaScript">
	    var plugin;
		function myDeclare() {
			if (navigator.appName.indexOf("Explorer") == -1) {
				explorer = false;
				plugin = navigator.mimeTypes["application/x-iid"];
			} else {
				explorer = true;
				if ( navigator.userAgent.indexOf("Windows NT 6") == -1 ) {
					plugin = ControlExists("IID.iIDCtl");
				} else {
					plugin = IsCSPInstalled("Net iD - CSP");
				}
			}
			if (plugin) {
				if (explorer) {
					document.writeln("<object name=\"iID\" classid=\"CLSID:5BF56AD2-E297-416E-BC49-00B327C4426E\" width=\"0\" height=\"0\"></object>");
				} else {
					document.writeln("<object name=\"iID\" type=\"application/x-iid\" width=\"0\" height=\"0\"></object>");
				}
			} else {
				document.writeln("The CryptoAPI component is not installed.");
			}
		} // myDeclare

		function generate_pkcs10()
		{
		    document.iID.SetProperty('Base64', 'true');
		    document.iID.SetProperty('URLEncode', 'false');
		    document.iID.SetProperty('Password', '');
		    document.iID.SetProperty('TokenLabel', "Prime EID IP1 (basic PIN)");
		    document.iID.SetProperty('Subject', "2.5.4.5=197205250777");
		    document.iID.SetProperty('KeyId', '45');
		
			rv = document.iID.Invoke('CreateRequest');
			if (rv == 0)
				document.form1.authpkcs10.value = document.iID.GetProperty("Request");
			else
				document.form1.authpkcs10.value = rv;
		
		    document.iID.SetProperty('Base64', 'true');
		    document.iID.SetProperty('URLEncode', 'false');
		    document.iID.SetProperty('Password', '');
		    document.iID.SetProperty('TokenLabel', "Prime EID IP1 (signature PIN)");
		    document.iID.SetProperty('Subject', "2.5.4.5=197205250777");
		    document.iID.SetProperty('KeyId', '46');
		
			rv = document.iID.Invoke('CreateRequest');
			if (rv == 0)
				document.form1.signpkcs10.value = document.iID.GetProperty("Request");
			else
				document.form1.signpkcs10.value = rv;

			if (navigator.appName.indexOf("Explorer") != -1 && navigator.userAgent.indexOf("Windows NT 6") != -1 ) {
					document.form1.classid.value = "clsid:884e2049-217d-11da-b2a4-000e7bbb2b09";
			}

			document.form1.submit();	
		} // generate_pkcs10

		myDeclare();
	</SCRIPT>
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<NOSCRIPT>
<P><B>Javascript is turned off or you don't have a browser that can
handle Javascript.</NOSCRIPT></B> 
</P>
<H1>Renewal of certificates on PrimeCard smart cards.</H1>
<P>From this page you can renew the certificate on your smart
card if you have NetID (4.2.0.18 or later) installed.</P>
<P>The process is roughly like this:</P>
<OL>
	<LI><P>This page is accessed with https and client authentication.
	The card that will have its certificates renewed should be used to
	authenticate with.</P>
	<LI><P>The NetID plugin is used to create one certificate request
	for each key on the card with Javascript. These request are then
	posted to a servlet.</P>
	<LI><P>The servlet checks if the client authentication certificate
	is revoked. If it is an error message is returned</P>
	<LI><P>The servlet uses the client authentication certificate to
	find the user name.</P>
	<LI><P>The status of the user is checked by the servlet. If not new
	an error message is returned.</P>
	<LI><P>All certificates belonging to the user that is not revoked is
	revoked (this should only be the old certificates of the card) by
	the servlet.</P>
	<LI><P>New certificates are issued by the servlet for the card with
	the previously received certificate requests.</P>
	<LI><P>A new response page is then created by the servlet. A
	template for this page is used. On the page it is a Javascript
	that deletes the old revoked certificates and install new ones
	instead. The template contains tags that is replaced by certificates
	to be removed or added.</P>
</OL>
<P>Configuration of the servlet is made in the file ./WEB-INF/web.xml
file. The class name of the servlet must be
<FONT FACE="Monospace"><FONT SIZE=3>org.ejbca.ui.web.pub.CardCertReqServlet</FONT><FONT SIZE=2>.
</FONT></FONT>The following parameters are used:</P>
<TABLE WIDTH=100% BORDER=0 CELLPADDING=0 CELLSPACING=0>
	<COL WIDTH=37*>
	<COL WIDTH=219*>
	<TR VALIGN=TOP>
		<TD WIDTH=14%>
			<P><FONT FACE="Monospace"><FONT SIZE=3>responseTemplate</FONT></FONT></P>
		</TD>
		<TD WIDTH=86%>
			<P>The URL of the file to be used as response template. Mandatory.</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=14%>
			<P><FONT FACE="Monospace"><FONT SIZE=3>authCertProfile</FONT></FONT></P>
		</TD>
		<TD WIDTH=86%>
			<P>Certificate profile used to create the new authenticating
			certificate. If absent the certificate profile of the user is
			used.</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=14%>
			<P><FONT FACE="Monospace"><FONT SIZE=3>signCertProfile</FONT></FONT></P>
		</TD>
		<TD WIDTH=86%>
			<P>Certificate profile used to create the new signing certificate.
			If absent the certificate profile of the user is used.</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=14%>
			<P><FONT FACE="Monospace"><FONT SIZE=3>signCA</FONT></FONT></P>
		</TD>
		<TD WIDTH=86%>
			<P>CA used to sign the new signing certificate. If absent the CA
			of the user is used.</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=14%>
			<P><FONT FACE="Monospace"><FONT SIZE=3>authCA</FONT></FONT></P>
		</TD>
		<TD WIDTH=86%>
			<P>CA used to sign the new authenticating certificate. If absent
			the CA of the user is used.</P>
		</TD>
	</TR>
</TABLE>
<P>It is recommended that at least either <FONT FACE="Monospace"><FONT SIZE=3>authCertProfile</FONT><FONT SIZE=2>
</FONT></FONT>or <FONT SIZE=3><FONT FACE="Monospace">signCertProfile</FONT></FONT>
is used since key usage should be different for the new certificates.
</P>
<FORM NAME="form1" ACTION="cardcertreq" METHOD="POST">
	<INPUT TYPE=HIDDEN NAME="authpkcs10">
	<INPUT TYPE=HIDDEN NAME="signpkcs10">
	<TABLE CELLPADDING=2 CELLSPACING=2>
		<TR>
			<TD>
				<P><INPUT TYPE=BUTTON VALUE="Fetch Certificate" STYLE="width: 3.25cm; height: 0.66cm" ONCLICK="generate_pkcs10()"></P>
				<INPUT NAME="classid" TYPE="hidden"  VALUE="">
			</TD>
		</TR>
	</TABLE>
</FORM>
<P><BR><BR>
</P>
</BODY>
</HTML>